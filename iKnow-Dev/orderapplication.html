<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<title>iKnow-OrderApplication</title>
		<script src="js/mui.js"></script>
		<link href="css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
		<script src="https://checkout.stripe.com/checkout.js"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init({
				swipeBack: true
			});
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();
				document.getElementById("servicename").innerHTML = self.servicename;
				document.getElementById("price").innerHTML = "￥" + self.price;
				//document.getElementById("membersspan").innerHTML = ;
				//document.getElementById("massagistspan").innerHTML = obj.funcdes;
				//document.getElementById("timeslotspan").innerHTML = self.shopname;
				document.getElementById("totalspan").innerHTML = "￥" + self.price;
				//document.getElementById("namespan").innerHTML = obj.intro;
				//document.getElementById("phonespan").innerHTML = distance + "Km";
				var handler = StripeCheckout.configure({
					key: 'pk_test_XOAM8G6tnBANFHGUKpqRRvx0',
					image: '/img/documentation/checkout/marketplace.png',
					locale: 'auto',
					token: function(token) {
						console.log(token.id)
							// Use the token to create the charge with a server-side script.
							// You can access the token ID with `token.id`
						mui.ajax('http://gene.rnet.missouri.edu/iKnow/test/charge.php', {
							data: {
								stripeToken: token.id,
							},
							//dataType: 'json', //服务器返回json格式数据
							type: 'post', //HTTP请求类型
							timeout: 10000, //超时时间设置为10秒；
							success: function(data) {
								//服务器返回响应，根据响应结果，分析是否登录成功；
								mui.openWindow({
									id: 'paymentsuccess',
									url: "PaymentSuccess.html",
									styles: {
										popGesture: 'close'
									},
									show: {
										autoShow: true, //页面loaded事件发生后自动显示，默认为true
										aniShow: 'pop-in', //页面显示动画，默认为”slide-in-right“；
										duration: 300 //页面动画持续时间，Android平台默认100毫秒，iOS平台默认200毫秒；
									},
									waiting: {
										autoShow: true, //自动显示等待框，默认为true
										title: '正在加载...', //等待对话框上显示的提示内容
									}
								});
							},
							error: function(xhr, type, errorThrown) {
								//异常处理；
								console.log(errorThrown);
							}
						});
					}
				});
				document.getElementById("orderbtn").addEventListener('tap', function(e) {
					handler.open({
						name: '身知道预订支付',
						description: '东方力道中医推拿院-单人全身精油按摩',
						amount: self.price*100,
						image: 'http://gene.rnet.missouri.edu/iKnow/img/icon/icon180.png',
						alipay: 'true',
						currency:'CNY'
					});
					e.preventDefault();
				})
			})
		</script>

		<script type="text/javascript">
			 // H5 plus事件处理
			function plusReady() {
				// 设置系统状态栏背景为红色
				plus.navigator.setStatusBarBackground("#6acccb");
				plus.navigator.setStatusBarStyle("UIStatusBarStyleBlackOpaque");
			}
			if (window.plus) {
				plusReady();
			} else {
				document.addEventListener("plusready", plusReady, false);
			}
		</script>
		<style>
			html,
			body {
				min-height: 100%;
				background-color: #efeff4;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="position: fixed; background-color: #6ACCCB;">
			<h1 id="title" class="mui-title" style="color: #ffffff;">订单确认</h1>
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left icon-whilte"></a>
		</header>
		<div style="height:60px;position: relative;top:60px;background-color: #ffffff;">
			<span style="font-size:14px;color: #333333;line-height: 60px;padding-left: 15px;" id="servicename">小儿保健套餐</span>
			<span class="mui-pull-right" style="line-height: 60px;padding-right: 15px;color: #FF9900;font-size: 14px;" id="price">$98</span>
		</div>
		<div style="height:50px;position: relative;top:80px;background-color: #ffffff;">
			<a class="mui-navigate-right" style="font-size:14px;color: #333333;line-height: 50px;padding-left: 15px;">人数<span class="mui-pull-right" style="padding-right:40px;color:#ff9900" id="membersspan">3</span></a>
		</div>
		<div style="height:50px;position: relative;top:81px;background-color: #ffffff;">
			<a class="mui-navigate-right" style="font-size:14px;color: #333333;line-height: 50px;padding-left: 15px;">中医保健按摩师<span class="mui-pull-right" style="padding-right:40px;color:#ff9900" id="massagistspan">丁亮</span></a>
		</div>
		<div style="height:50px;position: relative;top:82px;background-color: #ffffff;">
			<a class="mui-navigate-right" style="font-size:14px;color: #333333;line-height: 50px;padding-left: 15px;">服务时间<span class="mui-pull-right" style="padding-right:40px;color:#ff9900" id="timeslotspan">18:00-19:00</span></a>
		</div>
		<div style="height:50px;position: relative;top:102px;background-color: #ffffff;">
			<a class="mui-navigate-right" style="font-size:14px;color: #333333;line-height: 50px;padding-left: 15px;">现金券/代金券/优惠码</a>
		</div>
		<div style="height:50px;position: relative;top:103px;background-color: #ffffff;">
			<span style="font-size:14px;color: #333333;line-height: 50px;padding-left: 15px;">订单合计</span>
			<span class="mui-pull-right" style="line-height: 50px;padding-right: 15px;color: #ff9900;font-size: 14px;" id="totalspan">$98</span>
		</div>

		<div style="height:50px;position: relative;top:123px;background-color: #ffffff;">
			<span style="font-size:14px;color: #333333;line-height: 50px;padding-left: 15px;" id="namespan">张三</span>
			<span class="mui-pull-right" style="line-height: 50px;padding-right: 15px;color: #ff9900;font-size: 14px;" id="phonespan">+86 13000000000</span>
		</div>

		<div id="orderbtn" style="text-align:center;position: relative;top:143px;margin-bottom: 20px;"><a class="mui-btn mui-btn-negative" style="width:120px;height:40px;line-height: 25px;">Pay by Stripe</a></div>

		<script>
			 //更换标题
			title.innerHTML = this.querySelector('.mui-tab-label').innerHTML;
		</script>

	</body>

</html>